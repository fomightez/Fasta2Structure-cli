name: pytest_test_settings

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r binder/requirements.txt
    - name: Prepare and run modified postBuild script
      run: |
        echo "Current working directory: $PWD"
        echo "GitHub workspace: $GITHUB_WORKSPACE"
        echo "Contents of current directory:"
        ls -la
        echo "Contents of Example_data/Results:"
        ls -la Example_data/Results
        sed 's|cd ~|cd $GITHUB_WORKSPACE|g' binder/postBuild > modified_postBuild
        chmod +x modified_postBuild
        bash -x ./modified_postBuild
  working-directory: ${{ github.workspace }}
    - name: Run improved script with conftest.py and run tests with pytest
      run: pytest -v tests/test_no_changes_introduced_to_results.py
